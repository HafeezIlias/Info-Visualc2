{% extends "base.html" %}

{% block title %}E-MISSION ASIA VS EUROPE (2000 - 2022){% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="hero-section" data-aos="fade-up" data-aos-duration="1200">
        <h1 class="hero-title">
            <i class="fas fa-chart-line me-3"></i>
            CO2 Emissions Visualization
        </h1>
        <p class="hero-subtitle">
            E-MISSION ASIA VS EUROPE (2000 - 2022) - Interactive Data Analysis Dashboard
        </p>
        <div class="team-badge" data-aos="zoom-in" data-aos-delay="300">
            <span class="badge-text">BY GROUP 3</span>
            <div class="team-members">
                <span>KOY CHANG WEI (295972)</span>
                <span>GERALD TAN HOCK SOON (294879)</span>
                <span>MUHAMMAD HAFEEZ BIN ILIAS (292892)</span>
            </div>
        </div>
    </div>

    <!-- Statistics Overview -->
    <div class="hero-stats mt-5" data-aos="fade-up" data-aos-delay="300">
        <div class="row text-center">
            <div class="col-lg-3 col-md-6 mb-4" data-aos="zoom-in" data-aos-delay="100">
                <div class="stat-item glass-effect">
                    <div class="stat-icon">
                        <i class="fas fa-smog fa-3x mb-3"></i>
                    </div>
                    <h4 class="stat-number">992.31K</h4>
                    <p class="stat-label">Total CO2 Emissions</p>
                    <small class="text-muted">Metric Tons</small>
                    <div class="stat-progress">
                        <div class="progress-bar" style="--progress: 85%"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4" data-aos="zoom-in" data-aos-delay="200">
                <div class="stat-item glass-effect">
                    <div class="stat-icon">
                        <i class="fas fa-leaf fa-3x mb-3"></i>
                    </div>
                    <h4 class="stat-number">50.86%</h4>
                    <p class="stat-label">Renewable Energy</p>
                    <small class="text-muted">Average Usage</small>
                    <div class="stat-progress">
                        <div class="progress-bar" style="--progress: 51%"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4" data-aos="zoom-in" data-aos-delay="300">
                <div class="stat-item glass-effect">
                    <div class="stat-icon">
                        <i class="fas fa-bolt fa-3x mb-3"></i>
                    </div>
                    <h4 class="stat-number">3.27M</h4>
                    <p class="stat-label">Energy Consumption</p>
                    <small class="text-muted">TWh</small>
                    <div class="stat-progress">
                        <div class="progress-bar" style="--progress: 75%"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4" data-aos="zoom-in" data-aos-delay="400">
                <div class="stat-item glass-effect">
                    <div class="stat-icon">
                        <i class="fas fa-city fa-3x mb-3"></i>
                    </div>
                    <h4 class="stat-number">60.20%</h4>
                    <p class="stat-label">Urbanization Rate</p>
                    <small class="text-muted">Average</small>
                    <div class="stat-progress">
                        <div class="progress-bar" style="--progress: 60%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Interactive Map Section -->
    <div class="row mt-5" data-aos="fade-up" data-aos-delay="400">
        <div class="col-12">
            <div class="card modern-card">
                <div class="card-header">
                    <h4 class="text-gradient">
                        <i class="fas fa-globe-americas me-2"></i>Global CO2 Emissions Map
                    </h4>
                    <p class="text-muted mb-0">Interactive world map showing CO2 emissions by country</p>
                </div>
                <div class="card-body">
                    <div class="map-container mb-3">
                        <div id="world-emissions-map" style="height: 500px;"></div>
                    </div>
                    <div class="text-center">
                        <div class="btn-group" role="group">
                            <button class="btn btn-outline-primary active toggle-btn" data-continent="all">
                                <i class="fas fa-globe me-1"></i> All Countries
                            </button>
                            <button class="btn btn-outline-primary toggle-btn" data-continent="asia">
                                <i class="fas fa-map-marked-alt me-1"></i> Asia
                            </button>
                            <button class="btn btn-outline-primary toggle-btn" data-continent="europe">
                                <i class="fas fa-map-marker-alt me-1"></i> Europe
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Power BI Analytics Section -->
    <div class="row mt-5" data-aos="fade-up" data-aos-delay="500">
        <div class="col-12">
            <div class="card modern-card">
                <div class="card-header">
                    <h4 class="text-gradient">
                        <i class="fas fa-chart-bar me-2"></i>Power BI Analytics Dashboard
                    </h4>
                    <p class="text-muted mb-0">Advanced analytics and insights from integrated Power BI</p>
                </div>
                <div class="card-body">
                    <div class="powerbi-container position-relative">
                        <iframe 
                            title="CO2 Emissions Analytics" 
                            width="100%" 
                            height="600" 
                            src="https://app.powerbi.com/reportEmbed?reportId=2d197c6b-f90f-4dd2-87ad-8b5d38a00113&autoAuth=true&ctid=d494e113-528e-40ab-90d9-162de2fca3f3" 
                            frameborder="0" 
                            allowFullScreen="true"
                            class="rounded"
                            style="z-index: 10; position: relative;">
                        </iframe>
                        <div class="powerbi-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" id="powerbi-loading" style="z-index: 5; pointer-events: none;">
                            <div class="text-center text-white">
                                <i class="fas fa-spinner fa-spin fa-3x mb-3"></i>
                                <h5>Loading Power BI Dashboard...</h5>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center gap-2 mt-3">
                        <button class="btn btn-primary modern-btn" onclick="refreshPowerBI()">
                            <i class="fas fa-sync-alt me-2"></i>Refresh
                            <span class="btn-shimmer"></span>
                        </button>
                        <button class="btn btn-success modern-btn" onclick="openPowerBIFullscreen()">
                            <i class="fas fa-expand me-2"></i>Full Screen
                            <span class="btn-shimmer"></span>
                        </button>
                        <button class="btn btn-info modern-btn" onclick="exportPowerBIData()">
                            <i class="fas fa-download me-2"></i>Export Data
                            <span class="btn-shimmer"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Controls Section -->
    <div class="row mt-5" data-aos="fade-up" data-aos-delay="500">
        <div class="col-12">
            <div class="card modern-card">
                <div class="card-header">
                    <h4 class="text-gradient mb-0">
                        <i class="fas fa-sliders-h me-2"></i>Filters & Controls
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Continent Filter -->
                        <div class="col-lg-3 col-md-6 mb-3">
                            <h6 class="mb-3"><i class="fas fa-globe me-2"></i>Continent</h6>
                            <div class="btn-group-vertical w-100" role="group">
                                <button class="btn btn-outline-primary active filter-btn" data-filter="continent" data-value="all">
                                    <i class="fas fa-check-circle me-2"></i>All Regions
                                </button>
                                <button class="btn btn-outline-primary filter-btn" data-filter="continent" data-value="asia">
                                    <i class="fas fa-map-marked-alt me-2"></i>Asia
                                </button>
                                <button class="btn btn-outline-primary filter-btn" data-filter="continent" data-value="europe">
                                    <i class="fas fa-map-marker-alt me-2"></i>Europe
                                </button>
                            </div>
                        </div>
                        
                        <!-- Country Filter -->
                        <div class="col-lg-3 col-md-6 mb-3">
                            <h6 class="mb-3"><i class="fas fa-flag me-2"></i>Country</h6>
                            <div class="btn-group-vertical w-100" role="group">
                                <button class="btn btn-outline-success active filter-btn" data-filter="country" data-value="all">
                                    <i class="fas fa-check-circle me-2"></i>All Countries
                                </button>
                                <button class="btn btn-outline-success filter-btn" data-filter="country" data-value="china">
                                    <i class="fas fa-flag me-2"></i>China
                                </button>
                                <button class="btn btn-outline-success filter-btn" data-filter="country" data-value="germany">
                                    <i class="fas fa-flag me-2"></i>Germany
                                </button>
                                <button class="btn btn-outline-success filter-btn" data-filter="country" data-value="india">
                                    <i class="fas fa-flag me-2"></i>India
                                </button>
                            </div>
                        </div>
                        
                        <!-- Industry Filter -->
                        <div class="col-lg-3 col-md-6 mb-3">
                            <h6 class="mb-3"><i class="fas fa-industry me-2"></i>Industry Type</h6>
                            <div class="btn-group-vertical w-100" role="group">
                                <button class="btn btn-outline-warning filter-btn" data-filter="industry" data-value="construction">
                                    <i class="fas fa-hammer me-2"></i>Construction
                                </button>
                                <button class="btn btn-outline-warning filter-btn" data-filter="industry" data-value="energy">
                                    <i class="fas fa-bolt me-2"></i>Energy
                                </button>
                                <button class="btn btn-outline-warning filter-btn" data-filter="industry" data-value="manufacturing">
                                    <i class="fas fa-cogs me-2"></i>Manufacturing
                                </button>
                                <button class="btn btn-outline-warning filter-btn" data-filter="industry" data-value="mining">
                                    <i class="fas fa-pickaxe me-2"></i>Mining
                                </button>
                            </div>
                        </div>
                        
                        <!-- System Status -->
                        <div class="col-lg-3 col-md-6 mb-3">
                            <h6 class="mb-3"><i class="fas fa-plug me-2"></i>System Status</h6>
                            <div class="d-flex flex-column gap-2">
                                <div>
                                    <span class="badge bg-success me-2">
                                        <i class="fas fa-check-circle"></i>
                                    </span>
                                    <small>Power BI Connected</small>
                                </div>
                                <div>
                                    <span class="badge bg-success me-2">
                                        <i class="fas fa-check-circle"></i>
                                    </span>
                                    <small>Live Data Feed</small>
                                </div>
                                <div>
                                    <span class="badge bg-warning me-2">
                                        <i class="fas fa-clock"></i>
                                    </span>
                                    <small>Export Processing</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Interactive Charts Section -->
    <div class="row mt-5">
        <div class="col-lg-4 col-md-6 mb-4" data-aos="slide-right" data-aos-delay="200">
            <div class="card feature-card h-100 modern-card">
                <div class="card-body">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-industry"></i>
                    </div>
                    <h5 class="card-title text-gradient">Industry Comparison</h5>
                    <p class="card-text text-muted mb-3">CO2 contribution by industry type</p>
                    <div id="chart-industry-comparison" style="height: 300px;"></div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4" data-aos="slide-up" data-aos-delay="250">
            <div class="card feature-card h-100 modern-card">
                <div class="card-body">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-chart-area"></i>
                    </div>
                    <h5 class="card-title text-gradient">Sector Emissions Trend</h5>
                    <p class="card-text text-muted mb-3">Historical sector emission patterns</p>
                    <div id="chart-sector-emission" style="height: 300px;"></div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4" data-aos="slide-left" data-aos-delay="300">
            <div class="card feature-card h-100 modern-card">
                <div class="card-body">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h5 class="card-title text-gradient">Renewable Energy</h5>
                    <p class="card-text text-muted mb-3">Country-wise renewable energy adoption</p>
                    <div id="chart-renewable-energy" style="height: 300px;"></div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4" data-aos="slide-right" data-aos-delay="350">
            <div class="card feature-card h-100 modern-card">
                <div class="card-body">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <h5 class="card-title text-gradient">Emissions Breakdown</h5>
                    <p class="card-text text-muted mb-3">Sector-wise emission distribution</p>
                    <div id="chart-emissions-donut" style="height: 300px;"></div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4" data-aos="slide-up" data-aos-delay="400">
            <div class="card feature-card h-100 modern-card">
                <div class="card-body">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h5 class="card-title text-gradient">Emission Timeline</h5>
                    <p class="card-text text-muted mb-3">CO2 emissions over time</p>
                    <div id="chart-emissions-time" style="height: 300px;"></div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4" data-aos="slide-left" data-aos-delay="450">
            <div class="card feature-card h-100 modern-card">
                <div class="card-body">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-coins"></i>
                    </div>
                    <h5 class="card-title text-gradient">GDP vs Emissions</h5>
                    <p class="card-text text-muted mb-3">Economic correlation analysis</p>
                    <div id="chart-gdp-emissions" style="height: 300px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Modern Visualization Styles - Matching index.html */
    .hero-section {
        text-align: center;
        padding: 80px 0 40px;
        background: linear-gradient(135deg, var(--glass-bg) 0%, rgba(255,255,255,0.02) 100%);
        border-radius: 30px;
        margin-bottom: 20px;
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        box-shadow: var(--shadow-light);
        animation: fadeInUp 1s ease-out;
    }

    .hero-title {
        font-family: 'Poppins', sans-serif;
        font-size: 3.5rem;
        font-weight: 800;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 20px;
        animation: slideInFromTop 1s ease-out 0.3s both;
    }

    .hero-subtitle {
        font-size: 1.3rem;
        color: var(--text-secondary);
        margin-bottom: 30px;
        font-weight: 300;
        animation: slideInFromTop 1s ease-out 0.6s both;
    }

    .team-badge {
        display: inline-block;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 20px 30px;
        margin-top: 20px;
        animation: slideInFromTop 1s ease-out 0.9s both;
    }

    .badge-text {
        display: block;
        font-size: 1.2rem;
        font-weight: 700;
        background: var(--gradient-secondary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
    }

    .team-members {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .team-members span {
        font-size: 0.9rem;
        color: var(--text-muted);
        font-weight: 500;
    }

    .header-section {
        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        border-radius: 15px;
        padding: 20px;
        margin: 0 20px 20px 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    /* Statistics Cards - Matching index.html style */
    .hero-stats {
        animation: fadeInUp 1s ease-out 0.5s both;
    }

    .stat-item {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 25px;
        padding: 40px 20px;
        text-align: center;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: var(--shadow-light);
        position: relative;
        overflow: hidden;
        min-height: 280px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .stat-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--gradient-primary);
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 0;
    }

    .stat-item:hover::before {
        opacity: 0.1;
    }

    .stat-item:hover {
        transform: translateY(-15px) scale(1.02);
        box-shadow: 0 25px 60px rgba(102, 126, 234, 0.4);
        border-color: rgba(102, 126, 234, 0.6);
    }

    .stat-item > * {
        position: relative;
        z-index: 1;
    }

    .stat-icon {
        color: var(--primary-color);
        margin-bottom: 20px;
        animation: pulse 2s infinite;
    }

    .stat-number {
        font-family: 'Poppins', sans-serif;
        font-size: 2.8rem;
        font-weight: 800;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
        line-height: 1;
    }

    .stat-label {
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 8px;
    }

    .stat-progress {
        width: 80%;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        overflow: hidden;
        margin-top: 20px;
    }

    .progress-bar {
        height: 100%;
        background: var(--gradient-primary);
        border-radius: 2px;
        width: var(--progress);
        animation: progressFill 2s ease-out 1s both;
    }

    @keyframes progressFill {
        from { width: 0; }
        to { width: var(--progress); }
    }

    /* Modern Card Styles - Matching index.html */
    .modern-card {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 25px;
        box-shadow: var(--shadow-light);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        overflow: hidden;
        position: relative;
    }

    .modern-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--gradient-primary);
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 0;
    }

    .modern-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 60px rgba(102, 126, 234, 0.3);
        border-color: rgba(102, 126, 234, 0.4);
    }

    .modern-card:hover::before {
        opacity: 0.05;
    }

    .modern-card > * {
        position: relative;
        z-index: 1;
    }

    .card-header {
        background: transparent;
        border-bottom: 1px solid var(--glass-border);
        padding: 25px 30px 20px;
    }

    .text-gradient {
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
    }

    .card-body {
        padding: 20px;
    }

    /* Reduced padding for chart cards */
    .feature-card .card-body {
        padding: 15px;
    }

    /* Feature Cards */
    .feature-card {
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 1px solid var(--glass-border);
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
    }
    
    .feature-card .stat-number {
        transition: transform 0.3s ease;
    }

    .feature-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 25px 60px rgba(102, 126, 234, 0.3);
    }

    .feature-icon {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        animation: glow 3s ease-in-out infinite alternate;
    }

    .modern-btn {
        background: var(--gradient-primary);
        border: none;
        border-radius: 15px;
        padding: 12px 30px;
        color: white;
        font-weight: 600;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .modern-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        color: white;
    }

    .btn-shimmer {
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.5s ease;
    }

    .modern-btn:hover .btn-shimmer {
        left: 100%;
    }

    /* PowerBI Overlay */
    .powerbi-overlay {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
        backdrop-filter: blur(10px);
        border-radius: 15px;
        transition: opacity 0.5s ease;
    }

    .main-content {

        grid-template-columns: 1fr 320px;
        gap: 20px;
        margin: 0 20px;
        padding: 0;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .hero-title {
            font-size: 2.8rem;
        }
        
        .hero-subtitle {
            font-size: 1.1rem;
        }
        
        .stat-number {
            font-size: 2.4rem;
        }
    }

    @media (max-width: 768px) {
        .hero-title {
            font-size: 2.2rem;
        }
        
        .hero-subtitle {
            font-size: 1rem;
        }
        
        .hero-section {
            padding: 60px 0 30px;
        }
        
        .team-badge {
            padding: 15px 20px;
        }
        
        .team-members {
            font-size: 0.8rem;
        }
        
        .stat-item {
            min-height: 220px;
            padding: 30px 15px;
        }
        
        .stat-number {
            font-size: 2rem;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }
    }

    @media (max-width: 576px) {
        .hero-title {
            font-size: 1.8rem;
        }
        
        .stat-item {
            min-height: 200px;
            padding: 25px 10px;
        }
        
        .btn-group-vertical .btn {
            font-size: 0.85rem;
            padding: 8px 12px;
        }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .main-content {
            grid-template-columns: 1fr;
            gap: 30px;
        }
        
        .charts-grid {
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(3, 1fr);
        }
        
        .chart-card {
            height: 350px;
        }
        
        .stats-container {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .dashboard-content {
            padding: 15px;
        }
        
        .header-section, .map-section, .powerbi-section {
            margin: 0 10px 15px 10px;
        }
        
        .main-content {
            margin: 0 10px;
        }
    }

    @media (max-width: 768px) {
        .charts-grid {
            grid-template-columns: 1fr;
            grid-template-rows: auto;
            gap: 15px;
        }
        
        .stats-container {
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .title-section {
            flex-direction: column;
            text-align: center;
            gap: 15px;
        }
        
        .team-info {
            text-align: center;
            margin-top: 15px;
        }

        .powerbi-controls {
            flex-direction: column;
            gap: 10px;
        }
        
        .dashboard-content {
            padding: 10px;
        }
        
        .header-section, .map-section, .powerbi-section {
            margin: 0 5px 10px 5px;
        }
        
        .main-content {
            margin: 0 5px;
        }
        
        .main-content {
            gap: 20px;
        }
        
        .chart-card {
            height: 300px;
        }
    }

    /* Animation for loading */
    .chart-card, .map-section, .powerbi-section {
        animation: fadeInUp 0.6s ease-out;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(255,255,255,0.1);
        border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(45deg, #3498db, #2ecc71);
        border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(45deg, #2980b9, #27ae60);
    }

    .continent-toggle {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 20px 0;
    }

    .toggle-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        background-color: #2c3e50;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .toggle-btn:hover {
        background-color: #34495e;
    }

    .toggle-btn.active {
        background-color: #3498db;
    }
</style>

{% block extra_scripts %}
<script>
    // Filter state
    let currentFilters = {
        continent: 'all',
        country: 'all',
        industry: 'all'
    };

    // Initialize charts and map
    document.addEventListener('DOMContentLoaded', function() {
        renderWorldMap();
        renderCharts();
        initializeFilters();
        initializePowerBI();
        const toggleButtons = document.querySelectorAll('.toggle-btn');
        
        toggleButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                toggleButtons.forEach(btn => btn.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                
                // Get selected continent
                const continent = this.dataset.continent;
                
                // Update visualizations
                updateVisualizations(continent);
                // Update statistics
                updateStats(continent);
            });
        });
    });

    function renderWorldMap() {
        // Create world map showing countries in dataset
        const worldMapData = [{
            type: "choropleth",
            locationmode: 'country names',
            locations: ['China', 'Germany', 'India'],
            z: [992.31, 450.2, 320.8], // Sample emission values
            text: ['China: 992.31K tons', 'Germany: 450.2K tons', 'India: 320.8K tons'],
            colorscale: [
                [0, '#3498db'],
                [0.5, '#f39c12'],
                [1, '#e74c3c']
            ],
            reversescale: false,
            marker: {
                line: {
                    color: 'rgb(180,180,180)',
                    width: 0.5
                }
            },
            colorbar: {
                title: "CO2 Emissions<br>(Metric Tons)",
                titlefont: {color: 'white'},
                tickfont: {color: 'white'}
            }
        }];

        const worldMapLayout = {
            title: {
                text: 'CO2 Emissions by Country in Dataset',
                font: {color: 'white', size: 18}
            },
            template: 'plotly_dark',
            geo: {
                showframe: false,
                showcoastlines: true,
                showland: true,
                landcolor: 'rgba(255,255,255,0.1)',
                coastlinecolor: 'rgba(255,255,255,0.3)',
                projection: {type: 'natural earth'}
            },
            plot_bgcolor: 'rgba(0,0,0,0)',
            paper_bgcolor: 'rgba(0,0,0,0)',
            font: {color: 'white'}
        };

        Plotly.newPlot('world-emissions-map', worldMapData, worldMapLayout, {
            responsive: true,
            displayModeBar: false
        });
    }

    function initializePowerBI() {
        // Hide loading overlay after iframe loads
        const iframe = document.querySelector('.powerbi-container iframe');
        const overlay = document.getElementById('powerbi-loading');
        
        if (iframe && overlay) {
            iframe.onload = function() {
                setTimeout(() => {
                    overlay.style.opacity = '0';
                    overlay.style.pointerEvents = 'none';
                    setTimeout(() => {
                        overlay.style.display = 'none';
                    }, 500);
                }, 1000);
            };
        }
    }

    function refreshPowerBI() {
        const iframe = document.querySelector('.powerbi-container iframe');
        const overlay = document.getElementById('powerbi-loading');
        
        overlay.style.display = 'flex';
        overlay.style.opacity = '1';
        
        // Reload iframe
        iframe.src = iframe.src;
    }

    function openPowerBIFullscreen() {
        const powerbiUrl = "https://app.powerbi.com/reportEmbed?reportId=2d197c6b-f90f-4dd2-87ad-8b5d38a00113&autoAuth=true&ctid=d494e113-528e-40ab-90d9-162de2fca3f3";
        window.open(powerbiUrl, '_blank');
    }

    function exportPowerBIData() {
        // This would typically call Power BI API for data export
        alert('Export functionality would integrate with Power BI API for data extraction.');
    }

    function renderCharts() {
        // Common chart configuration
        const chartConfig = {
            responsive: true, 
            displayModeBar: false,
            staticPlot: false,
            showTips: true
        };

        // Render all charts with modern styling
        const chartLayout = {
            height: 260,
            margin: {l: 40, r: 40, t: 20, b: 40},
            autosize: true,
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: {
                color: 'white',
                family: 'Inter, sans-serif'
            }
        };

        {% if charts.industry_comparison %}
        var chart1 = {{ charts.industry_comparison|safe }};
        Object.assign(chart1.layout, chartLayout);
        Plotly.newPlot('chart-industry-comparison', chart1.data, chart1.layout, chartConfig);
        {% endif %}

        {% if charts.sector_emission %}
        var chart2 = {{ charts.sector_emission|safe }};
        Object.assign(chart2.layout, chartLayout);
        Plotly.newPlot('chart-sector-emission', chart2.data, chart2.layout, chartConfig);
        {% endif %}

        {% if charts.renewable_energy %}
        var chart3 = {{ charts.renewable_energy|safe }};
        Object.assign(chart3.layout, chartLayout);
        Plotly.newPlot('chart-renewable-energy', chart3.data, chart3.layout, chartConfig);
        {% endif %}

        {% if charts.emissions_donut %}
        var chart4 = {{ charts.emissions_donut|safe }};
        Object.assign(chart4.layout, chartLayout);
        Plotly.newPlot('chart-emissions-donut', chart4.data, chart4.layout, chartConfig);
        {% endif %}

        {% if charts.emissions_time %}
        var chart5 = {{ charts.emissions_time|safe }};
        Object.assign(chart5.layout, chartLayout);
        Plotly.newPlot('chart-emissions-time', chart5.data, chart5.layout, chartConfig);
        {% endif %}

        {% if charts.gdp_emissions %}
        var chart6 = {{ charts.gdp_emissions|safe }};
        Object.assign(chart6.layout, chartLayout);
        Plotly.newPlot('chart-gdp-emissions', chart6.data, chart6.layout, chartConfig);
        {% endif %}

        // Ensure proper resizing on window resize
        window.addEventListener('resize', function() {
            Plotly.Plots.resize('chart-industry-comparison');
            Plotly.Plots.resize('chart-sector-emission');
            Plotly.Plots.resize('chart-renewable-energy');
            Plotly.Plots.resize('chart-emissions-donut');
            Plotly.Plots.resize('chart-emissions-time');
            Plotly.Plots.resize('chart-gdp-emissions');
        });
    }

    function initializeFilters() {
        // Add event listeners for filter buttons
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', function() {
                const filterType = this.getAttribute('data-filter');
                const filterValue = this.getAttribute('data-value');
                
                // Update active state within the same filter group
                const filterGroup = this.parentNode;
                filterGroup.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // Update filter state
                currentFilters[filterType] = filterValue;
                
                // Apply filters and update charts
                updateChartsAndStats();
                
                // Also update visualizations for continent filter
                if (filterType === 'continent') {
                    updateVisualizations(filterValue);
                    updateStats(filterValue);
                }
            });
        });
        
        // Add toggle button listeners for map section
        document.querySelectorAll('.toggle-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all toggle buttons
                document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                
                // Get selected continent
                const continent = this.dataset.continent;
                
                // Update visualizations
                updateVisualizations(continent);
                updateStats(continent);
            });
        });
    }

    // Update charts and statistics when filters change
    function updateChartsAndStats() {
        // Get current filter values from active buttons
        const continentBtn = document.querySelector('.filter-btn[data-filter="continent"].active');
        const countryBtn = document.querySelector('.filter-btn[data-filter="country"].active');
        const industryBtn = document.querySelector('.filter-btn[data-filter="industry"].active');
        
        const continent = continentBtn ? continentBtn.getAttribute('data-value') : 'all';
        const country = countryBtn ? countryBtn.getAttribute('data-value') : 'all';
        const industry = industryBtn ? industryBtn.getAttribute('data-value') : 'all';
        
        // Show loading state
        document.querySelectorAll('.feature-card').forEach(container => {
            container.style.opacity = '0.7';
        });
        
        // Simulate chart updates (replace with actual API calls when available)
        console.log('Updating charts with filters:', { continent, country, industry });
        
        // Re-render charts with current data but apply visual feedback
        setTimeout(() => {
            // Reset opacity
            document.querySelectorAll('.feature-card').forEach(container => {
                container.style.opacity = '1';
            });
            
            // Add a brief highlight effect to show update
            document.querySelectorAll('.feature-card').forEach((container, index) => {
                setTimeout(() => {
                    container.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        container.style.transform = 'scale(1)';
                    }, 200);
                }, index * 100);
            });
        }, 800);
        
        // Update statistics display
        updateStatsDisplay(continent, country, industry);
    }
    
    function updateStatsDisplay(continent, country, industry) {
        // Simple stats update based on filters (replace with real data)
        const stats = {
            'all': { emissions: '992.31K', renewable: '50.86%', energy: '3.27M', urbanization: '60.20%' },
            'asia': { emissions: '720.15K', renewable: '45.32%', energy: '2.45M', urbanization: '58.75%' },
            'europe': { emissions: '272.16K', renewable: '62.18%', energy: '0.82M', urbanization: '73.42%' }
        };
        
        const currentStats = stats[continent] || stats['all'];
        
        // Update stat numbers with animation
        const statElements = [
            { id: 'emissions', value: currentStats.emissions },
            { id: 'renewable', value: currentStats.renewable },
            { id: 'energy', value: currentStats.energy },
            { id: 'urbanization', value: currentStats.urbanization }
        ];
        
        statElements.forEach((stat, index) => {
            const elements = document.querySelectorAll('.stat-number');
            if (elements[index]) {
                setTimeout(() => {
                    elements[index].style.transform = 'scale(1.1)';
                    elements[index].textContent = stat.value;
                    setTimeout(() => {
                        elements[index].style.transform = 'scale(1)';
                    }, 300);
                }, index * 150);
            }
        });
    }

    // Add dynamic effects
    function addDynamicEffects() {
        // Particle effect for background
        const container = document.querySelector('.container');
        
        // Create floating particles
        for (let i = 0; i < 15; i++) {
            const particle = document.createElement('div');
            particle.style.cssText = `
                position: absolute;
                width: 4px;
                height: 4px;
                background: rgba(52, 152, 219, 0.3);
                border-radius: 50%;
                pointer-events: none;
                animation: float ${5 + Math.random() * 5}s infinite linear;
                left: ${Math.random() * 100}%;
                top: ${Math.random() * 100}%;
                z-index: 1;
            `;
            container.appendChild(particle);
        }
    }

    // CSS for particle animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }
    `;
    document.head.appendChild(style);

    // Initialize dynamic effects
    setTimeout(addDynamicEffects, 1000);

    function updateVisualizations(continent) {
        fetch('/api/visualization', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ continent: continent })
        })
        .then(response => response.json())
        .then(data => {
            // Update each chart
            Object.keys(data).forEach(chartId => {
                const chart = document.getElementById(chartId);
                if (chart) {
                    Plotly.newPlot(chartId, JSON.parse(data[chartId]));
                }
            });
        })
        .catch(error => console.error('Error:', error));
    }

    function updateStats(continent) {
        fetch('/api/update_stats', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ continent: continent })
        })
        .then(response => response.json())
        .then(data => {
            // Update your statistics display
            document.getElementById('totalEmissions').textContent = data.totalEmissions;
            document.getElementById('renewableEnergy').textContent = data.renewableEnergy;
            document.getElementById('energyConsumption').textContent = data.energyConsumption;
            document.getElementById('urbanization').textContent = data.urbanization;
        })
        .catch(error => console.error('Error:', error));
    }
</script>
{% endblock %}
{% endblock %} 